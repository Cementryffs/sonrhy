<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Blind Test Rap US</title>
    <style>
#custom-audio-player {
    background: #333;
    border-radius: 20px;
    padding: 20px;
    display: inline-block;
    margin-bottom: 20px;
}
#playPauseBtn {
    background: #ff9800;
    color: #fff;
    border: none;
    border-radius: 10px;
    padding: 10px 30px;
    font-size: 18px;
    cursor: pointer;
}
#seekBar {
    width: 500px;
    margin: 0 15px;
}
#currentTime, #duration {
    font-family: monospace;
    font-size: 16px;
}

        body { font-family: Arial, sans-serif; text-align: center; background: #222; color: #fff; }
        .question { margin: 30px 0; }
        .controls { 
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 15px;
            margin: 20px 0;
        }
        
        .controls button { 
            margin: 0; 
            padding: 15px 100px; 
            font-size: 16px; 
            transition: all 0.3s ease;
            height: 50px;
            overflow: hidden;
            position: relative;
            background: linear-gradient(45deg, #333, #555);
            color: white;
            border: 2px solid #ff9800;
            border-radius: 8px;
            cursor: pointer;
            width: 400px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .controls button:hover {
            height: 120px;
        }
        
        .controls button::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: var(--bg-image, none);
            background-size: cover;
            background-repeat: no-repeat;
            background-position: center;
            opacity: 0;
            transition: all 0.3s ease;
            z-index: 1;
            border-radius: 8px;
            pointer-events: none;
        }
        
        .controls button:hover::before {
            opacity: 0.3;
        }
        
        .controls button span {
            position: relative;
            z-index: 2;
        }
        
        .correct-answer {
            transform: scale(1.3) !important;
            height: 150px !important;
            font-size: 20px !important;
            font-weight: bold !important;
            box-shadow: 0 10px 30px rgba(76, 175, 80, 0.5) !important;
            z-index: 10 !important;
            position: relative !important;
        }
        

        
        .correct-answer span {
            position: relative !important;
            z-index: 2 !important;
            color: white !important;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8) !important;
            font-weight: bold !important;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); box-shadow: 0 0 0 0 rgb(255, 255, 255); }
            70% { transform: scale(1.05); box-shadow: 0 0 0 10px rgba(255, 152, 0, 0); }
            100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(255, 152, 0, 0); }
        }
        
        .pulse-animation {
            animation: pulse 0.6s ease-out;
        }
        
        .correct-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: flex-end;
            align-items: center;
            z-index: 1000;
            opacity: 0;
            transition: opacity 0.5s ease;
            padding-bottom: 50px;
        }
        
        .correct-overlay.show {
            opacity: 1;
        }
        
        .correct-image {
            position: absolute;
            top: 10%;
            left: 10%;
            width: 80%;
            height: 80%;
            background-size: cover;
            background-repeat: no-repeat;
            background-position: center;
            z-index: 1;
            cursor: pointer;
            border-radius: 15px;
        }
        
        .correct-text {
            position: relative;
            z-index: 2;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(15px);
            padding: 20px 30px;
            border-radius: 15px;
            color: white;
            font-size: 24px;
            font-weight: bold;
            text-align: center;
            margin: 10px 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }
        
        .correct-next-btn {
            position: relative;
            z-index: 2;
            background: rgba(76, 175, 80, 0.9);
            backdrop-filter: blur(10px);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            margin-top: 10px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 20px rgba(76, 175, 80, 0.3);
        }
        
        .correct-next-btn:hover {
            background: rgba(76, 175, 80, 1);
            transform: translateY(-2px);
            box-shadow: 0 6px 25px rgba(76, 175, 80, 0.4);
        }
        
        .correct-image .overlay-play-btn {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 60px;
            height: 60px;
            background: rgba(0, 0, 0, 0.7);
            border: 3px solid white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity 0.3s ease;
            cursor: pointer;
        }
        
        .correct-image:hover .overlay-play-btn {
            opacity: 1;
        }
        
        .correct-image .overlay-play-btn::before {
            content: '';
            width: 0;
            height: 0;
            border-left: 15px solid white;
            border-top: 10px solid transparent;
            border-bottom: 10px solid transparent;
            margin-left: 3px;
        }
        
        .correct-image .overlay-play-btn.pause::before {
            content: '';
            width: 4px;
            height: 20px;
            background: white;
            border: none;
            box-shadow: 8px 0 0 white;
            margin-left: 0;
        }
        
        .correct-text {
            color: white;
            font-size: 24px;
            font-weight: bold;
            text-align: center;
            margin-bottom: 30px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        }
        
        .correct-next-btn {
            background: linear-gradient(45deg, #4CAF50, #66BB6A);
            color: white;
            border: none;
            border-radius: 10px;
            padding: 15px 40px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 5px 15px rgba(76, 175, 80, 0.3);
            transition: all 0.3s ease;
        }
        
        .correct-next-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(76, 175, 80, 0.4);
        }
        
        .score { margin-top: 20px; font-size: 18px; }
        audio { margin-top: 20px; }
        
        /* Styles pour la page d'accueil */
        .homepage {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 50%, #1a1a1a 100%);
            padding: 20px;
        }
        
        .homepage-content {
            text-align: center;
            max-width: 600px;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 152, 0, 0.3);
        }
        
        .homepage-title {
            font-size: 3em;
            margin-bottom: 20px;
            background: linear-gradient(45deg, #ff9800, #ffb74d);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-shadow: 0 4px 8px rgba(255, 152, 0, 0.3);
        }
        
        .homepage-description {
            font-size: 1.2em;
            margin-bottom: 30px;
            color: #e0e0e0;
            line-height: 1.6;
        }
        
        .homepage-features {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-bottom: 40px;
        }
        
        .feature {
            background: rgba(255, 152, 0, 0.1);
            padding: 15px;
            border-radius: 10px;
            border-left: 4px solid #ff9800;
            color: #fff;
            font-size: 1.1em;
        }
        
        .start-btn {
            background: linear-gradient(45deg, #ff9800, #ffb74d);
            color: white;
            border: none;
            padding: 20px 40px;
            font-size: 1.3em;
            font-weight: bold;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 10px 30px rgba(255, 152, 0, 0.3);
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .start-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 40px rgba(255, 152, 0, 0.4);
            background: linear-gradient(45deg, #ffb74d, #ff9800);
        }
        
        .gamearea {
            padding: 20px;
        }
    </style>
</head>
<body>
    <!-- Page d'accueil -->
    <div id="homepage" class="homepage">
        <div class="homepage-content">
            <h1 class="homepage-title">🎵 Blind Test Rap US 🎵</h1>
            <p class="homepage-description">
                Testez vos connaissances du rap américain !<br>
                Écoutez les extraits et devinez les bonnes réponses.
            </p>
            <div class="homepage-features">
                <div class="feature">🎧 Extraits audio de qualité</div>
                <div class="feature">⏱️ Système de temps progressif</div>
                <div class="feature">🏆 Score en temps réel</div>
            </div>
            <button class="start-btn" onclick="startGame()">Commencer le jeu</button>
        </div>
    </div>

    <!-- Page de jeu (cachée au début) -->
    <div id="gamearea" class="gamearea" style="display: none;">
        <h1>Blind Test Rap US</h1>
        <div class="question">
            <div id="question-number">Question 1/8</div>
            <audio id="audio" style="display:none;"></audio>

            <div id="custom-audio-player">
                <button id="playPauseBtn">Lecture</button>
                <span id="currentTime">0:00</span> / <span id="duration">0:00</span>
                <input type="range" id="seekBar" value="0" min="0" step="1">
                <button id="addTimeButton" onclick="addTime()">Ajouter 10 secondes</button>
            </div>
            <div class="controls">
                <button onclick="guess('A')"></button>
                <button onclick="guess('B')"></button>
                <button onclick="guess('C')"></button>
            </div>
            <div id="feedback"></div>
            <div class="score">Score: <span id="score">0</span></div>
            <button onclick="nextQuestion()">Question suivante</button>
        </div>
    </div>

    <script>

            
        // filepath: c:\Users\alexg\son.rhy\SONGRHYME.html
const audio = document.getElementById('audio');
const playPauseBtn = document.getElementById('playPauseBtn');
const seekBar = document.getElementById('seekBar');
const currentTimeSpan = document.getElementById('currentTime');
const durationSpan = document.getElementById('duration');
playPauseBtn.onclick = function() {
    // Ajouter l'animation pulse au bouton
    playPauseBtn.classList.add('pulse-animation');
    
    // Retirer la classe après l'animation
    setTimeout(() => {
        playPauseBtn.classList.remove('pulse-animation');
    }, 600);
    
    if (audio.paused) {
        audio.play().catch(error => {
            console.error('Erreur lors de la lecture audio:', error);
            console.log('URL audio:', audio.src);
        });
        playPauseBtn.textContent = "Pause";
        playPauseBtn.style.background = "green"; // Vert quand lecture
        playPauseBtn.style.color = "white"
    } else {
        audio.pause();
        playPauseBtn.textContent = "Lecture";
        playPauseBtn.style.background = "black"; // Noir quand pause
        playPauseBtn.style.color = "green";
    }
};

audio.onloadedmetadata = function() {
    seekBar.max = Math.floor(audio.duration);
    durationSpan.textContent = formatTime(audio.duration);
};

audio.ontimeupdate = function() {
    seekBar.value = Math.floor(audio.currentTime);
    currentTimeSpan.textContent = formatTime(audio.currentTime);
};

seekBar.oninput = function() {
    audio.currentTime = seekBar.value;
};

function formatTime(sec) {
    sec = Math.floor(sec);
    return `${Math.floor(sec/60)}:${('0'+(sec%60)).slice(-2)}`;
}
        let allQuestions = [];
        
        // Fonction pour charger les musiques depuis le fichier JSON
        async function loadSongsFromJSON() {
            try {
                console.log('Tentative de chargement du fichier questions.json...');
                const response = await fetch('./questions.json');
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                console.log('Données JSON chargées:', data);
                
                return data.songs;
            } catch (error) {
                console.error('Erreur lors du chargement des musiques:', error);
                console.log('Utilisation des musiques de fallback');
                
                // Musiques de fallback en cas d'erreur - utiliser des URLs de test
                return [
                    {
                        id: 1,
                        title: "Test Audio",
                        artist: "Test Artist",
                        album: "Test Album",
                        audioUrl: "https://www.soundjay.com/misc/sounds/bell-ringing-05.wav",
                        coverUrl: "https://via.placeholder.com/400x400/333/fff?text=Test+Audio"
                    },
                    {
                        id: 2,
                        title: "Sample Track",
                        artist: "Sample Artist",
                        album: "Sample Album",
                        audioUrl: "https://file-examples.com/storage/fe68c8a7d9e2bb0c2c97fd8/2017/11/file_example_MP3_700KB.mp3",
                        coverUrl: "https://via.placeholder.com/400x400/666/fff?text=Sample+Track"
                    },
                    {
                        id: 3,
                        title: "Demo Song",
                        artist: "Demo Artist", 
                        album: "Demo Album",
                        audioUrl: "https://www.learningcontainer.com/wp-content/uploads/2020/02/Kalimba.mp3",
                        coverUrl: "https://via.placeholder.com/400x400/999/fff?text=Demo+Song"
                    }
                ];
            }
        }
        
        // Fonction pour générer des questions aléatoires à partir des musiques
        function generateRandomQuestions(songs, numberOfQuestions = 8) {
            const questions = [];
            const usedSongs = new Set();
            
            for (let i = 0; i < numberOfQuestions && i < songs.length; i++) {
                // Choisir une musique aléatoire qui n'a pas encore été utilisée
                let correctSong;
                do {
                    correctSong = songs[Math.floor(Math.random() * songs.length)];
                } while (usedSongs.has(correctSong.id));
                
                usedSongs.add(correctSong.id);
                
                // Générer 2 fausses réponses aléatoires avec leurs images
                const wrongAnswers = [];
                const wrongSongs = [];
                const availableSongs = songs.filter(s => s.id !== correctSong.id);
                
                while (wrongAnswers.length < 2 && availableSongs.length > 0) {
                    const randomIndex = Math.floor(Math.random() * availableSongs.length);
                    const wrongSong = availableSongs[randomIndex];
                    wrongAnswers.push(`${wrongSong.artist} - ${wrongSong.title}`);
                    wrongSongs.push(wrongSong);
                    availableSongs.splice(randomIndex, 1);
                }
                
                // Créer les 3 réponses avec leurs données complètes
                const correctAnswer = `${correctSong.artist} - ${correctSong.title}`;
                const allAnswers = [
                    { text: correctAnswer, song: correctSong },
                    { text: wrongAnswers[0] || "Réponse manquante", song: wrongSongs[0] || null },
                    { text: wrongAnswers[1] || "Réponse manquante", song: wrongSongs[1] || null }
                ];
                
                // Mélanger les réponses
                for (let j = allAnswers.length - 1; j > 0; j--) {
                    const k = Math.floor(Math.random() * (j + 1));
                    [allAnswers[j], allAnswers[k]] = [allAnswers[k], allAnswers[j]];
                }
                
                // Trouver la position de la bonne réponse après mélange
                const correctIndex = allAnswers.findIndex(answer => answer.text === correctAnswer);
                const correctLetter = ['A', 'B', 'C'][correctIndex];
                
                // Créer la question
                const question = {
                    audio: correctSong.audioUrl,
                    answers: {
                        A: allAnswers[0].text,
                        B: allAnswers[1].text, 
                        C: allAnswers[2].text
                    },
                    answerCovers: {
                        A: allAnswers[0].song?.coverUrl || 'https://via.placeholder.com/400x400/333/fff?text=Album+Cover',
                        B: allAnswers[1].song?.coverUrl || 'https://via.placeholder.com/400x400/333/fff?text=Album+Cover',
                        C: allAnswers[2].song?.coverUrl || 'https://via.placeholder.com/400x400/333/fff?text=Album+Cover'
                    },
                    correct: correctLetter,
                    coverUrl: correctSong.coverUrl,
                    title: correctAnswer,
                    artist: correctSong.artist,
                    album: correctSong.album
                };
                
                questions.push(question);
            }
            
            console.log('Questions générées:', questions);
            return questions;
        }
        
        // Fonction pour mélanger un tableau
        function shuffleArray(array) {
            const shuffled = [...array];
            for (let i = shuffled.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
            }
            return shuffled;
        }
        
        // Variable pour stocker les questions mélangées
        let questions = [];
        let current = 0, score = 0;
        let maxTime = 10; // Temps maximum initial
        let timerId = null;

        let limitPlaybackFunction = null;
        let isAnswered = false;

        document.getElementById('audio').addEventListener('play', function() {
            const audio = this;
            
            // Ne pas appliquer la limitation si une réponse a été donnée
            if (isAnswered) return;
            
            limitPlaybackFunction = function() {
                if (audio.currentTime >= maxTime && !isAnswered) {
                    audio.pause();
                    audio.currentTime = maxTime;
                }
            };
             function timescore() {
                if (audio.currentTime >= 5 && !isAnswered) {
                    score+=5;
                }
                
             }

            function replayMusic() {
            if (audio.currentTime >= maxTime) {
                audio.currentTime = 0;
                audio.pause();
            }
            }
            audio.addEventListener('timeupdate', limitPlaybackFunction);
            audio.addEventListener('ended', () => {
            audio.removeEventListener('timeupdate', limitPlaybackFunction);
            
            setTimeout(() => { audio.currentTime = 0; }, 500); 
            });
        });

        document.getElementById('audio').addEventListener('pause', function() {
            if (this.currentTime >= maxTime) {
            this.currentTime = 0; // Réinitialise le timer à 0 si le lecteur est en pause à 10 secondes
            }
            // Ne pas réinitialiser maxTime lors de la pause pour permettre à la musique de continuer
        });

        function addTime() {
            // Ajouter l'animation pulse au bouton
            const addTimeBtn = document.getElementById('addTimeButton');
            addTimeBtn.classList.add('pulse-animation');
            
            // Retirer la classe après l'animation
            setTimeout(() => {
                addTimeBtn.classList.remove('pulse-animation');
            }, 600);
            
            maxTime += 10; // Ajoute 10 secondes au timer
        }

        function loadQuestion() {
            console.log('loadQuestion appelée, current:', current, 'questions:', questions);
            
            if (!questions || questions.length === 0) {
                console.error('Aucune question disponible');
                return;
            }
            
            if (current >= questions.length) {
                console.error('Index de question invalide:', current);
                return;
            }
            
            const q = questions[current];
            console.log('Question chargée:', q);
            
            const audio = document.getElementById('audio');
            const wasPlaying = !audio.paused;
            
            // Réinitialiser le flag de réponse pour la nouvelle question
            isAnswered = false;
            
            console.log('Chargement de l\'audio:', q.audio);
            
            // Créer un son simple avec Web Audio API en cas d'échec
            function createTestBeep() {
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.frequency.setValueAtTime(440, audioContext.currentTime);
                oscillator.type = 'sine';
                
                gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 2);
                
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 2);
                
                return audioContext;
            }
            
            // Essayer de charger l'audio, sinon utiliser un bip
            audio.src = q.audio || '';
            
            // Si pas d'URL ou URL invalide, créer un bip de test
            if (!q.audio || q.audio.includes('example.com')) {
                console.log('URL audio invalide, création d\'un bip de test');
                setTimeout(() => {
                    if (audio.error) {
                        createTestBeep();
                    }
                }, 1000);
            }
            
            // Ajouter des événements pour diagnostiquer le chargement (une seule fois)
            audio.removeEventListener('loadstart', audioLoadStart);
            audio.removeEventListener('canplay', audioCanPlay);
            audio.removeEventListener('error', audioError);
            
            function audioLoadStart() { console.log('Début du chargement audio'); }
            function audioCanPlay() { console.log('Audio prêt à être joué'); }
            function audioError(e) {
                console.error('Erreur de chargement audio:', e);
                console.error('Code d\'erreur:', audio.error?.code);
                console.error('Message d\'erreur:', audio.error?.message);
                console.error('URL problématique:', audio.src);
                
                // Utiliser Web Audio API comme fallback
                console.log('Fichier audio non compatible, utilisation d\'un bip de test');
                createTestBeep();
            }
            
            audio.addEventListener('loadstart', audioLoadStart);
            audio.addEventListener('canplay', audioCanPlay);
            audio.addEventListener('error', audioError);
            
            // Si la musique jouait, la relancer après le changement de source
            if (wasPlaying) {
                audio.addEventListener('loadeddata', function() {
                    audio.play();
                }, { once: true });
            }
            
            document.querySelectorAll('.controls button').forEach((btn, i) => {
                const answerLetter = ['A','B','C'][i];
                btn.textContent = `${q.answers[answerLetter]}`;
                btn.disabled = false;
                // Réinitialiser le style des boutons
                btn.style.background = 'linear-gradient(45deg, #333, #555)';
                btn.style.borderColor = '#ff9800';
                btn.style.color = 'white';
                btn.style.display = 'block';
                btn.classList.remove('correct-answer');
                
                // Définir l'image de fond selon la cover de chaque réponse
                const coverUrl = q.answerCovers[answerLetter];
                if (coverUrl) {
                    btn.style.setProperty('--bg-image', `url('${coverUrl}')`);
                } else {
                    // Image par défaut si pas de cover
                    btn.style.setProperty('--bg-image', `url('https://via.placeholder.com/400x400/333/fff?text=Album+Cover')`);
                }
            });
            document.getElementById('feedback').textContent = '';
        }

        function guess(answer) {
            const q = questions[current];
            
            // Marquer qu'une réponse a été donnée et supprimer la limitation
            isAnswered = true;
            const audio = document.getElementById('audio');
            if (limitPlaybackFunction) {
                audio.removeEventListener('timeupdate', limitPlaybackFunction);
                limitPlaybackFunction = null;
            }
            
            // Ajouter l'animation pulse au bouton cliqué
            const clickedButton = event.target;
            clickedButton.classList.add('pulse-animation');
            
            // Retirer la classe après l'animation
            setTimeout(() => {
                clickedButton.classList.remove('pulse-animation');
            }, 600);
            
            // Colorer toutes les réponses
            document.querySelectorAll('.controls button').forEach((btn, i) => {
                const btnAnswer = ['A','B','C'][i];
                btn.disabled = true;
                
                if (btnAnswer === q.correct) {
                    // Bonne réponse en vert avec agrandissement
                    btn.style.background = 'linear-gradient(45deg, #4CAF50, #66BB6A)';
                    btn.style.borderColor = '#4CAF50';
                    btn.style.color = 'white';
                    btn.classList.add('correct-answer');
                } else {
                    // Mauvaises réponses en rouge
                    btn.style.background = 'linear-gradient(45deg, #f44336, #ef5350)';
                    btn.style.borderColor = '#f44336';
                    btn.style.color = 'white';
                }
            });
            
            if (answer === q.correct) {
                score++;
                document.getElementById('feedback').textContent = "Bien joué !";
            } else {
                document.getElementById('feedback').textContent = "Bien tenté !";
            }
            document.getElementById('score').textContent = score;

            // Jouer automatiquement la musique après la réponse
            setTimeout(() => {
                if (isAnswered) {
                    audio.play();
                    playPauseBtn.textContent = "Pause";
                    playPauseBtn.style.background = "green";
                    playPauseBtn.style.color = "white";
                }
            }, 500); // Délai de 500ms pour laisser le temps à l'interface de se mettre à jour

            // Attendre 4 secondes puis afficher l'overlay centré
            if (timerId) clearTimeout(timerId);
            timerId = setTimeout(() => {
                // Cacher les mauvaises réponses
                document.querySelectorAll('.controls button').forEach((btn, i) => {
                    const btnAnswer = ['A','B','C'][i];
                    if (btnAnswer !== q.correct) {
                        btn.style.display = 'none';
                    }
                });
                
                // Créer et afficher l'overlay centré
                const correctAnswerText = q.answers[q.correct];
                
                // Utiliser la cover d'album de la question ou une image par défaut
                let correctImageUrl = q.coverUrl || 'https://via.placeholder.com/400x400/333/fff?text=Album+Cover';
                
                const overlay = document.createElement('div');
                overlay.className = 'correct-overlay';
                overlay.innerHTML = `
                    <div class="correct-image" style="background-image: url('${correctImageUrl}'); background-size: cover; background-position: center; background-repeat: no-repeat;">
                        <div class="overlay-play-btn" onclick="toggleOverlayAudio()"></div>
                    </div>
                    <div class="correct-text">${correctAnswerText}</div>
                    <button class="correct-next-btn" onclick="closeOverlayAndNext()">Question suivante</button>
                `;
                document.body.appendChild(overlay);
                
                // Afficher l'overlay avec animation
                setTimeout(() => {
                    overlay.classList.add('show');
                }, 100);
            }, 4000);
        }

        function nextQuestion() {
            current++;
            if (current < questions.length) {
            loadQuestion();
            } else {
            document.querySelector('.question').innerHTML = `<h2>Fin du jeu !</h2><p>Score final: ${score}/${questions.length}</p>`;
            }
        }

        async function restartGame() {
            // Recharger les musiques et générer de nouvelles questions
            const songs = await loadSongsFromJSON();
            allQuestions = generateRandomQuestions(songs, 8);
            
            // Remélanger les questions pour un nouveau jeu
            questions = shuffleArray(allQuestions);
            current = 0;
            score = 0;
            maxTime = 10;
            document.querySelector('.question').innerHTML = `
            <audio id="audio" style="display:none;"></audio>

<div id="custom-audio-player">
    <button id="playPauseBtn">Lecture</button>
    <span id="currentTime">0:00</span> / <span id="duration">0:00</span>
    <input type="range" id="seekBar" value="0" min="0" step="1">
    <button id="addTimeButton" onclick="addTime()">Ajouter 10 secondes</button>
</div>
<div class="controls">
    <button onclick="guess('A')"></button>
    <button onclick="guess('B')"></button>
    <button onclick="guess('C')"></button>
</div>
<div id="feedback"></div>
<div class="score">Score: <span id="score">0</span></div>
<button onclick="nextQuestion()">Question suivante</button>
            `;
            
            // Réattacher les événements du lecteur audio
            const audio = document.getElementById('audio');
            const playPauseBtn = document.getElementById('playPauseBtn');
            const seekBar = document.getElementById('seekBar');
            const currentTimeSpan = document.getElementById('currentTime');
            const durationSpan = document.getElementById('duration');
            
            playPauseBtn.onclick = function() {
                playPauseBtn.classList.add('pulse-animation');
                setTimeout(() => {
                    playPauseBtn.classList.remove('pulse-animation');
                }, 600);
                
                if (audio.paused) {
                    audio.play();
                    playPauseBtn.textContent = "Pause";
                    playPauseBtn.style.background = "green";
                    playPauseBtn.style.color = "white"
                } else {
                    audio.pause();
                    playPauseBtn.textContent = "Lecture";
                    playPauseBtn.style.background = "black";
                    playPauseBtn.style.color = "green";
                }
            };
            
            audio.onloadedmetadata = function() {
                seekBar.max = Math.floor(audio.duration);
                durationSpan.textContent = formatTime(audio.duration);
            };
            
            audio.ontimeupdate = function() {
                seekBar.value = Math.floor(audio.currentTime);
                currentTimeSpan.textContent = formatTime(audio.currentTime);
            };
            
            seekBar.oninput = function() {
                audio.currentTime = seekBar.value;
            };
            
            loadQuestion();
        }

        function showEndScreen() {
            document.querySelector('.question').innerHTML = `
            <h2>Fin du jeu !</h2>
            <p>Score final: ${score}/${questions.length}</p>
            <button onclick="restartGame()">Rejouer</button>
            `;
        }

        const originalNextQuestion = nextQuestion;
        nextQuestion = function() {
            current++;
            if (current < questions.length) {
            loadQuestion();
            } else {
            showEndScreen();
            }
        };

        function toggleOverlayAudio() {
            const audio = document.getElementById('audio');
            const playBtn = document.querySelector('.overlay-play-btn');
            
            // Temporairement désactiver la limitation de temps
            const wasAnswered = isAnswered;
            isAnswered = true;
            
            if (audio.paused) {
                audio.play();
                playBtn.classList.add('pause');
            } else {
                audio.pause();
                playBtn.classList.remove('pause');
            }
            
            // Restaurer l'état original après un court délai
            setTimeout(() => {
                isAnswered = wasAnswered;
            }, 100);
        }

        function closeOverlayAndNext() {
            // Supprimer l'overlay
            const overlay = document.querySelector('.correct-overlay');
            if (overlay) {
                overlay.classList.remove('show');
                setTimeout(() => {
                    overlay.remove();
                }, 500);
            }
            
            // Passer à la question suivante
            nextQuestion();
        }

        // Initialisation du jeu
        async function initGame() {
            console.log('Initialisation du jeu...');
            const songs = await loadSongsFromJSON();
            allQuestions = generateRandomQuestions(songs, 8);
            questions = shuffleArray(allQuestions);
            current = 0;
            score = 0;
            isAnswered = false;
            
            console.log('Jeu initialisé avec', questions.length, 'questions');
        }

        async function startGame() {
            console.log('startGame appelée');
            
            try {
                // Cacher la page d'accueil et afficher la zone de jeu AVANT d'initialiser
                document.getElementById('homepage').style.display = 'none';
                document.getElementById('gamearea').style.display = 'block';
                
                // Maintenant initialiser le jeu avec les éléments DOM visibles
                await initGame();
                
                // Mettre à jour les éléments UI maintenant qu'ils sont visibles
                document.getElementById('score').textContent = score;
                document.getElementById('question-number').textContent = `Question ${current + 1}/${questions.length}`;
                
                loadQuestion();
            } catch (error) {
                console.error('Erreur dans startGame:', error);
            }
        }

        // Ne pas charger automatiquement la première question au démarrage
        // loadQuestion();
        </script>
    </body>
    </html>
